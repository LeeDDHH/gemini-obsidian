コードの重複は常に避けるべきという「DRY（Don't Repeat Yourself）」原則は開発のベストプラクティスとして広く知られていますが、この記事では、適切な境界なしにDRYが過度に使用されると、かえって問題を引き起こす可能性があると指摘しています。DRYの動機を再検討し、コードの重複が許容される場合と、共有コンポーネントを採用する場合の最小限のプラクティスについてガイドラインを提示しています。

「早すぎる抽象化」は、開発の初期段階で抽象化が必要だと判断してしまうことで、実際には共通の振る舞いが存在しないにもかかわらず、パターンを見つけようと急ぎすぎることが原因で発生します。これにより、リファクタリングが必要になったり、認知負荷が増大したり、コード間の結合度が高まったりする副作用が生じます。

では、どのような場合にDRYを適用すべきでしょうか。最も適切な候補は「ビジネスルール」です。ビジネスルールは、システム全体で一貫性を保つ必要があり、重複すると問題を引き起こしやすいため、DRYの適用が強く推奨されます。一方、インフラストラクチャ関連の懸念事項など、他の部分での重複は、その重複の規模が非常に大きい（数百行）場合にのみ正当化されます。

ガイドラインとして、まず「早すぎる抽象化を避ける」ことが挙げられます。概念を十分に理解し、100%の一致が確認できてから共有コンテキストへの移行を検討すべきです。次に、「共有コンテキストを小さく保つ」ことが重要です。可能な限りモジュール化されたアプローチを好み、結合による影響範囲を最小限に抑えるべきです。また、共有コンポーネントは「バージョン管理」し、クライアントとは別にバージョン管理することで、変更の影響を管理しやすくします。さらに、「契約テスト」を実施することで、共有コンポーネントの変更が利用側のコードに予期せぬ影響を与えないことを確認できます。

結論として、DRYは「ルール」ではなく「ガイドライン」として捉えるべきです。静的解析ツールがコードの重複を指摘しても、それが常に悪いとは限りません。ビジネスルールの重複を避けることがDRYの真の目的であり、コードをレビューする際の第一の基準とすべきです。早すぎる抽象化の誘惑に抵抗し、共通の振る舞いが見つかった場合は、可能な限り小さく、凝集度の高いパッケージにまとめることが推奨されます。

Sources:
[1] Can Code Duplication Be a Good Thing? | by Mario Bittencourt ... (https://itnext.io/can-code-duplication-be-a-good-thing-39e0e43c0448)