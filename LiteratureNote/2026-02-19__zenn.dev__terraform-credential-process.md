---
type: literature
source_url: https://zenn.dev/masatoshi_tada/articles/a0cdce3e8961ca
source_title: Terraformのためにcredential_processがあるとaws loginできない現象への対策
source_type: web
created_at: 2026-02-19
updated_at: 2026-02-19
has_transcript: false
transcript_lang: N/A
failure_reason: N/A
tags: [AWS, Terraform, credential, DevOps, トラブルシューティング]
---

## TL;DR

- `~/.aws/config` の `credential_process` と `aws login` が競合する問題への対処法
- Terraform専用プロファイルを分離して `AWS_PROFILE` 環境変数で切り替えるのが解決策
- 複数の credential type 混在でも起きる `only one credential type may be specified per profile` エラーも解消
- 最終手段はシェルスクリプトで環境変数を直接設定する方法

## 要約

著者 Masatoshi Tada が AWS CLI + Terraform 環境で発生した credential 設定の競合問題と解決策を記録した記事。

### 環境
- AWS CLI 2.33.3 / Terraform 1.14.3 / Terraform AWS Provider 6.28.0 / macOS 26.2

### 発生した問題

**現象①**: `~/.aws/config` の `[default]` プロファイルに `credential_process` を設定すると、`aws login` 実行時に「Profile 'default' is already configured with Credential Process credentials」エラーが発生し、loginできなくなる。

**現象②**: `credential_process` を別プロファイル（App1）に移動してaws loginは成功したが、`terraform init` で「only one credential type may be specified per profile」エラーが発生。

### 解決策

**Terraform専用プロファイルを作成する**:
1. `App1-Terraform` という専用プロファイルを作成し、そこにのみ `credential_process` を設定
2. Terraform実行時に `export AWS_PROFILE=App1-Terraform` を指定
→ aws loginもTerraformも正常動作

**最終手段**: 上記でも解決しない場合、シェルスクリプト内で環境変数（`AWS_ACCESS_KEY_ID` など）を直接設定する（全スクリプトに同じコードが必要なため最終手段）。

## 核心ポイント

- **プロファイル分離戦略**: 用途別にAWSプロファイルを分けることでツール間の競合を回避
- **credential_process の制約**: defaultプロファイルへの設定はaws loginと競合しやすい
- **環境変数の活用**: `AWS_PROFILE` でCI/CDや特定ツール向けの認証を切り替え可能

## 内 적용 아이디어

- AWSのマルチアカウント・マルチツール環境ではプロファイル設計を最初から分離しておく
- `direnv` との組み合わせでディレクトリ毎に `AWS_PROFILE` を自動切り替えする運用も有効

---
*取得日: 2026-02-19 | ソース: zenn.dev | 著者: Masatoshi Tada*
